<div class="px-4 sm:px-0 max-w-4xl mx-auto">
  <div class="mb-6">
    <%= link_to brackets_path, class: "text-sm text-gray-500 hover:text-gray-700" do %>
      ← Back to Brackets
    <% end %>
  </div>

  <div class="bg-white shadow rounded-lg p-8">
    <h2 class="text-3xl font-bold text-gray-900 text-center mb-2">Record Bracket Result</h2>
    <p class="text-center text-gray-600 mb-8">
      <span class="px-3 py-1 rounded-full text-sm font-semibold
        <%= @bracket.bracket_type == 'winners' ? 'bg-green-100 text-green-800' : @bracket.bracket_type == 'losers' ? 'bg-orange-100 text-orange-800' : 'bg-yellow-100 text-yellow-800' %>">
        <%= @bracket.bracket_type.titleize %> Bracket
      </span>
      • Round <%= @bracket.round %> • Match <%= @bracket.position %>
    </p>

    <!-- Match Info -->
    <div class="mb-8 p-6 bg-gray-50 rounded-lg">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center">
          <h3 class="text-xl font-bold text-indigo-700"><%= @bracket.fighter1.name %></h3>
          <p class="text-sm text-gray-600"><%= @bracket.fighter1.club %></p>
          <div class="mt-2 text-sm text-gray-700">
            <div>Record: <%= @bracket.fighter1.wins %>-<%= @bracket.fighter1.losses %></div>
            <div>Points: <%= @bracket.fighter1.points %></div>
          </div>
        </div>
        
        <div class="flex items-center justify-center">
          <span class="text-2xl font-bold text-gray-400">VS</span>
        </div>
        
        <div class="text-center">
          <h3 class="text-xl font-bold text-purple-700"><%= @bracket.fighter2.name %></h3>
          <p class="text-sm text-gray-600"><%= @bracket.fighter2.club %></p>
          <div class="mt-2 text-sm text-gray-700">
            <div>Record: <%= @bracket.fighter2.wins %>-<%= @bracket.fighter2.losses %></div>
            <div>Points: <%= @bracket.fighter2.points %></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Winner Selection -->
    <%= form_with url: record_result_bracket_path(@bracket), method: :patch do |f| %>
      <%= hidden_field_tag :winner_id, nil, id: "winner_id_input" %>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <button type="button" onclick="selectWinner('<%= @bracket.fighter1_id %>', this)" 
                class="winner-button p-8 border-4 border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all">
          <div class="text-2xl font-bold text-gray-900 mb-2"><%= @bracket.fighter1.name %></div>
          <div class="text-sm text-gray-600"><%= @bracket.fighter1.club %></div>
          <div class="mt-4 text-indigo-600 font-semibold">Select as Winner</div>
        </button>
        
        <button type="button" onclick="selectWinner('<%= @bracket.fighter2_id %>', this)"
                class="winner-button p-8 border-4 border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all">
          <div class="text-2xl font-bold text-gray-900 mb-2"><%= @bracket.fighter2.name %></div>
          <div class="text-sm text-gray-600"><%= @bracket.fighter2.club %></div>
          <div class="mt-4 text-purple-600 font-semibold">Select as Winner</div>
        </button>
      </div>

      <div class="text-center">
        <button type="submit" id="submit-button" disabled
                class="px-8 py-4 border border-transparent text-lg font-bold rounded-md text-white bg-gray-400 cursor-not-allowed">
          Confirm Result
        </button>
      </div>
    <% end %>
  </div>
</div>

<script>
  let selectedWinner = null;

  function selectWinner(fighterId, button) {
    selectedWinner = fighterId;
    
    // Reset all buttons
    document.querySelectorAll('.winner-button').forEach(btn => {
      btn.classList.remove('border-green-500', 'bg-green-50', 'ring-4', 'ring-green-200');
      btn.classList.add('border-gray-300');
    });
    
    // Highlight selected button
    button.classList.remove('border-gray-300');
    button.classList.add('border-green-500', 'bg-green-50', 'ring-4', 'ring-green-200');
    
    // Update hidden field and enable submit
    document.getElementById('winner_id_input').value = fighterId;
    const submitButton = document.getElementById('submit-button');
    submitButton.disabled = false;
    submitButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
    submitButton.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-pointer');
  }
</script>